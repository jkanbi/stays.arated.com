<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stays Aggregator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè† Stays Aggregator</h1>
            <p>Find and manage property stays from various booking platforms</p>
        </header>


        <div class="search-section">
            <div class="search-group">
                <label for="searchInput">üîç Search Properties:</label>
                <input type="text" id="searchInput" placeholder="Search properties by name, location, or description...">
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="locationFilter">Location:</label>
                <select id="locationFilter">
                    <option value="">All Locations</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="amenityFilter">Amenities:</label>
                <select id="amenityFilter">
                    <option value="">All Amenities</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="typeFilter">Property Type:</label>
                <select id="typeFilter">
                    <option value="">All Types</option>
                    <option value="guest house">Guest House</option>
                    <option value="house">House</option>
                    <option value="flat">Flat</option>
                    <option value="hotel">Hotel</option>
                    <option value="other">Other</option>
                </select>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-number" id="totalProperties">0</span>
                <span class="stat-label">Total Properties</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="filteredProperties">0</span>
                <span class="stat-label">Filtered Results</span>
            </div>
        </div>

        <div class="view-toggle">
            <button id="tableViewBtn" class="view-btn active">üìã Table View</button>
            <button id="mapViewBtn" class="view-btn">üó∫Ô∏è Map View</button>
        </div>

        <div class="properties-container" id="propertiesContainer">
            <div class="no-data">
                <p>üìã No properties loaded. Upload a CSV file or load sample data to get started.</p>
            </div>
        </div>

        <div class="map-container" id="mapContainer" style="display: none;">
            <div id="map" style="height: 700px; width: 100%; border-radius: 15px;"></div>
        </div>

        <!-- Property Details Modal -->
        <div id="propertyModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Property Details</h2>
                    <span class="close" onclick="closePropertyModal()">&times;</span>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Property details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button onclick="closePropertyModal()" class="btn-secondary">Close</button>
                    <a id="modalBookingLink" href="#" target="_blank" class="btn-primary">View Booking</a>
                </div>
            </div>
        </div>

        <!-- Coordinate Picker Modal -->
        <div id="coordinateModal" class="modal" style="display: none;">
            <div class="modal-content coordinate-modal">
                <div class="modal-header">
                    <h2>üó∫Ô∏è Select Location on Map</h2>
                    <span class="close" onclick="closeCoordinateModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="coordinate-instructions">
                        <p>Click anywhere on the map to select coordinates for your property.</p>
                        <div class="coordinate-display">
                            <div class="coord-item">
                                <label>Latitude:</label>
                                <span id="selectedLat">Click on map</span>
                            </div>
                            <div class="coord-item">
                                <label>Longitude:</label>
                                <span id="selectedLng">Click on map</span>
                            </div>
                        </div>
                    </div>
                    <div id="coordinateMap" style="height: 70vh; width: 100%; border-radius: 10px;"></div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeCoordinateModal()" class="btn-secondary">Cancel</button>
                    <button onclick="useSelectedCoordinates()" class="btn-primary" id="useCoordsBtn" disabled>Use These Coordinates</button>
                </div>
            </div>
        </div>

        <!-- URL Loader Modal -->
        <div id="urlModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üåê Load CSV from URL</h2>
                    <span class="close" onclick="closeUrlModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="url-instructions">
                        <p>Enter a URL to a CSV file hosted online. The file should be publicly accessible and in CSV format.</p>
                    </div>
                    <div class="form-group">
                        <label for="csvUrl">CSV URL:</label>
                        <input type="url" id="csvUrl" placeholder="https://example.com/stays.csv" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div class="url-examples">
                        <p><strong>Examples:</strong></p>
                        <ul>
                            <li>GitHub raw files: <code>https://raw.githubusercontent.com/user/repo/main/stays.csv</code></li>
                            <li>Google Sheets (export as CSV): <code>https://docs.google.com/spreadsheets/d/.../export?format=csv</code></li>
                            <li>Dropbox/OneDrive public links</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeUrlModal()" class="btn-secondary">Cancel</button>
                    <button onclick="loadFromUrl()" class="btn-primary" id="loadUrlBtn">Load CSV</button>
                </div>
            </div>
        </div>

        <div class="add-property-section">
            <h3>‚ûï Add New Property</h3>
            <form id="addPropertyForm" class="property-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="propName">Property Name *</label>
                        <input type="text" id="propName" required>
                    </div>
                    <div class="form-group">
                        <label for="propUrl">Booking URL *</label>
                        <input type="url" id="propUrl" required placeholder="https://...">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="propType">Property Type *</label>
                        <select id="propType" required>
                            <option value="">Select Type</option>
                            <option value="guest house">Guest House</option>
                            <option value="house">House</option>
                            <option value="flat">Flat</option>
                            <option value="hotel">Hotel</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propLocation">Location</label>
                        <input type="text" id="propLocation" placeholder="City, State">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="propLatitude">Latitude (WGS84)</label>
                        <input type="number" id="propLatitude" placeholder="40.7128000" step="0.0000001">
                        <small style="color: #666; font-size: 0.8rem;">Use Google Maps format: -36.8485000</small>
                    </div>
                    <div class="form-group">
                        <label for="propLongitude">Longitude (WGS84)</label>
                        <input type="number" id="propLongitude" placeholder="-74.0060000" step="0.0000001">
                        <small style="color: #666; font-size: 0.8rem;">Use Google Maps format: 174.7633000</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button type="button" id="getCoordinatesBtn" class="btn-coordinates">
                            üó∫Ô∏è Get Coordinates from Map
                        </button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="propPrice">Price per Night (¬£)</label>
                        <input type="number" id="propPrice" placeholder="120" min="0">
                    </div>
                    <div class="form-group">
                        <label>Amenities</label>
                        <div class="amenities-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" value="wifi" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Wifi
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="aircon" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Aircon
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="kitchen" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Kitchen
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="washer" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Washer
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="dryer" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Dryer
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="parking" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Parking
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="self-checkin" class="amenity-checkbox">
                                <span class="checkmark"></span>
                                Self-Checkin
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="propDescription">Description</label>
                    <textarea id="propDescription" placeholder="Brief description of the property..."></textarea>
                </div>
                <button type="submit" class="btn-add">‚ûï Add Property</button>
            </form>
        </div>

        <div class="upload-section" id="uploadSection">
            <h3>üìÅ Data Import & Export</h3>
            <div class="file-upload" id="fileUploadArea">
                <div class="upload-content">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        <div class="upload-title">Drop CSV file here or click to browse</div>
                        <div class="upload-subtitle">Supports .csv files only</div>
                    </div>
                </div>
                <label for="csvFile" class="upload-btn">
                    üìÅ Choose File
                </label>
                <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
                <span class="file-info">No file selected</span>
            </div>
            <div class="upload-actions">
                <button id="loadDefault" class="btn-secondary">Load Sample Data</button>
                <button onclick="openUrlModal()" class="btn-secondary">üåê Load from URL</button>
                <button id="downloadCSV" class="btn-download">üíæ Download CSV</button>
                <button id="viewMap" class="btn-map">üó∫Ô∏è View on Map</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>
